ФУНКЦИОНАЛЬНОЕ ТЕХНИЧЕСКОЕ ЗАДАНИЕ (ФТЗ) v3.0 (FINAL)

Проект: Thompson EduPlay (Logic & Mechanics)

Этот документ описывает поведение системы, логику игр, интеграцию с AI, админ-панель и обработку пограничных ситуаций.
Используется в связке с Design_Spec_Thompson_EduPlay.md для визуального стиля.

1. АРХИТЕКТУРА И СТЕК

Framework: React (Vite).

State Management:

useState, useEffect (локальный стейт игр).

localStorage (хранение прогресса Гостя и токена авторизации).

Context API (глобальное состояние: User, Theme, Audio, Language).

AI Integration: OpenAI API (GPT-3.5/4) для генерации вопросов.

Localization: i18n. Языки: Русский (RU), Узбекский (UZ).

Audio: useSound. Глобальный переключатель Mute.

2. СЦЕНАРИЙ 1: АВТОРИЗАЦИЯ И МИГРАЦИЯ ДАННЫХ

Поведение: Единая точка входа с поддержкой переноса прогресса.

2.1. Логика "Гостя"

Кнопка "Играть без регистрации".

Создается профиль в localStorage: { role: 'guest', xp: 0, level: 1, history: [] }.

Весь опыт сохраняется локально.

2.2. Регистрация и Миграция

Пользователь (Гость) решает зарегистрироваться.

Логика: Система проверяет localStorage. Если там есть XP (>0):

Отправляет эти данные вместе с формой регистрации на бэкенд.

Новый аккаунт создается уже с накопленным опытом.

Локальное хранилище очищается.

Сброс пароля: Заглушка (Alert): "Пожалуйста, обратитесь к администратору школы для сброса пароля".

3. ЛОКАЛИЗАЦИЯ И AI

Синхронизация: Язык интерфейса определяет язык генерации вопросов.

Промпт для OpenAI:

"Generate 20 questions... on topic [Math]... strictly in [Russian/Uzbek] language depending on user selection."

Обработка ошибок AI:

Если API недоступен / Ошибка сети / Лимит токенов:

Действие: Показать модальное окно ошибки: "Сервис временно недоступен. Попробуйте позже".

Игра не запускается (фоллбэк вопросы отключены по требованию).

4. ИГРА 1: ПЕРЕТЯГИВАНИЕ КАНАТА ("Brain Tug")

Тип: Hotseat (2 игрока на одном устройстве).

4.1. Настройка (Setup)

Ввод имен двух команд.

Сложность: Одинаковая для обеих команд (выбирается общая категория).

4.2. Геймплей (Loop)

Управление состоянием:

Кнопка "Пауза" (II): Останавливает игру, блюрит экран.

Кнопка "Звук" (Mute): Выключает/включает эффекты.

Перезагрузка (F5): Прогресс текущей партии теряется полностью. Игра начинается с экрана настройки.

Механика:

Вопросы генерируются AI.

Нет таймера на ответ (время бесконечно).

Правильный ответ: Канат +10 к себе.

Неправильный ответ: Канат стоит на месте, ход переходит.

Условие победы: Полное перетягивание (+100 / -100).

4.3. Начисление Опыта (Scoring)

Принцип: Награда за участие и мастерство.

Формула:

Победитель: +50 XP (Бонус за победу) + (Кол-во верных ответов * 5 XP).

Проигравший: 0 XP (Бонус) + (Кол-во верных ответов * 5 XP).

Итог: Даже проигравшая команда получает опыт, если отвечала правильно.

5. ИГРА 2: ПАМЯТЬ ("Memory Matrix")

Тип: Одиночная.

5.1. Геймплей

Жизни: 1 (Хардкор). Ошибка = Конец игры.

Показ: Все клетки загораются одновременно.

Управление: Есть кнопки Пауза и Mute.

5.2. Начисление Опыта

+10 XP за каждый полностью пройденный уровень.

6. АДМИН-ПАНЕЛЬ (Учительская)

Роль: Учитель/Админ.

6.1. Генератор Вопросов (AI Workflow)

Ввод: Учитель выбирает тему, сложность, язык.

Генерация: Нажимает "Сгенерировать пак".

Предпросмотр (Review):

Система показывает список полученных вопросов в полях input / textarea.

Учитель может отредактировать текст вопроса или варианты ответов (исправить ошибки AI).

Учитель может удалить неудачные вопросы из пака.

Сохранение: Кнопка "Сохранить в базу". Только после этого вопросы становятся доступны в игре.

6.2. Управление Учениками

Просмотр списка.

Функции: Удалить профиль, Заблокировать доступ, Посмотреть статистику.

7. ЗВУКОВОЕ ОФОРМЛЕНИЕ (Assets)

UI (Интерфейс сайта): Беззвучный.

In-Game (Внутри игры):

Фоновая музыка (Ambient) — опционально, по умолчанию тихо.

SFX: Правильный ответ, Ошибка, Победа, Нажатие кнопок внутри игры.

Глобальный Mute выключает все звуки игры сразу.